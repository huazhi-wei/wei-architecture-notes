# 一、开发前设计思考

在正式编码之前进行系统性的设计，是避免项目后期失控、推倒重来的关键。本项目在经历 **IM 项目** 与 **网盘项目** 两个阶段后，逐步形成了“**底层框架 + 业务模块**”的整体设计思路。

---

## 1. 为什么要在开发前拆分为两个部分？

任何一个完整项目，本质上都同时包含：

* **通用的、可复用的部分**
* **与具体业务强相关的部分**

通过 IM 项目与网盘项目的对比，可以明显发现：

> 两个项目在网络通信、并发模型、配置管理等方面几乎完全一致，真正不同的只是业务功能。

因此，一个项目如果缺乏稳定、清晰的底层框架：

* 新功能会不断堆积到核心类中
* 代码会逐渐臃肿、耦合失控
* 项目难以扩展，更难以复用

### 结论

**项目应在开发前拆分为：**

* **底层框架（基础能力）**：项目的“根”
* **业务功能模块**：附着在底层框架之上的“积木”

只要底层框架稳定，业务就可以不断生长、演化成不同类型的项目。

---

# 二、底层框架设计

## 1. 底层框架的复用性分析

经过 IM 与网盘项目实践后可以得出结论：

> **IM 项目的底层框架几乎可以直接复用网盘项目的底层框架，仅业务模块不同。**

在后续项目中，可以：

1. 直接复用成熟的底层框架
2. 在其之上新增或替换业务模块
3. 避免重复造轮子

在复用之前，必须做到：

* 对现有框架代码结构非常熟悉
* 理解每个模块存在的意义与边界

---

## 2. 底层框架模块划分

### 2.1 网络层模块

**职责：**

* 实现客户端与服务端的通信
* 封装 socket、send / recv、粘包拆包
* 对上层隐藏底层通信细节

---

### 2.2 epoll + 线程池模块

**职责：**

* 处理高并发连接
* IO 与业务解耦
* 提供高效、稳定的并发模型

---

### 2.3 数据库模块

**职责：**

* 封装数据库连接与操作
* 向业务层提供统一的数据访问接口
* 避免业务层直接操作 SQL

---

### 2.4 配置文件模块

**职责：**

* 统一管理端口、数据库、路径等配置
* 支持灵活修改而不重新编译

---

### 2.5 MD5 加密模块

**职责：**

* 密码加密
* 文件校验
* 为上层业务提供统一加密能力

---

# 三、业务功能设计

## 1. 业务与底层框架的关系

当底层框架搭建完成后，项目本身是**没有任何业务功能的**。

最初的做法通常是：

* 在核心处理类（如 Kernel / Logic）中不断添加业务代码

但这种方式会导致：

* 核心类不断膨胀
* 业务强耦合
* 后期维护与复用困难

因此，业务功能必须进行拆解。

---

## 2. 业务功能模块化原则

* **简单业务**：可拆分为独立文件
* **复杂业务**：必须单独形成业务模块
* **可能复用的业务**：尽量模块化封装

模块拆分依据：

* 功能之间的联动性
* 未来是否可能在其他项目中使用

---

## 3. 业务功能拆解示例

### 3.1 注册 / 登录模块

* 注册

  * 手机验证码注册
* 登录

  * 忘记密码功能

---

### 3.2 单聊模块

* 文本消息
* 图片
* 文件
* 语音

---

### 3.3 多媒体相关功能

* 视频在线播放
* 音乐播放

---

### 3.4 文件功能模块

* 文件发送
* 文件接收

---

# 四、命名规范与开发规范

在完成需求分析与模块拆分后，需要制定统一规范以保证项目质量。

## 1. 命名规范

* 在开发前统一设计命名规则
* 对可能出现的变量、类、模块提前命名
* 开发过程中严格遵循命名表

**好处：**

* 提升代码可读性
* 降低维护成本
* 减少后期重构风险

---

## 2. 开发规范

* 模块职责单一
* 严禁跨层调用
* 通过接口而非具体实现交互

---

# 五、项目架构与开发计划

## 1. 项目架构图与流程图

在需求分析完成后，应：

* 绘制整体架构图
* 明确模块依赖关系
* 梳理核心业务流程

---

## 2. 最小可行性产品（MVP）

开发过程中应遵循：

> **先搭建最小可行性产品，再逐步演进。**

步骤：

1. 实现最基本的功能闭环
2. 确保系统稳定运行
3. 在此基础上逐步添加新功能

避免：

* 一开始就试图实现所有功能
* 需求失控导致项目失败

---

## 3. 迭代式开发思路

* 明确当前阶段目标
* 规划下一步功能
* 再规划下下步功能
* 通过分支管理逐步完善项目

---

# 六、总结

本项目的核心思想是：

> **以稳定的底层框架为基础，通过模块化业务不断演进项目形态。**

通过对网盘项目的拆解与抽象，可以为 IM 项目乃至未来更多项目，提供坚实、可复用的基础架构。
